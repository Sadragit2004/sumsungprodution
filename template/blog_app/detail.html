{% extends "main_template.html" %}

{% block meta1 %}
<!-- متا تگ‌ها -->
<title>{{ meta_tags.title }}</title>
<meta name="description" content="{{ meta_tags.description }}">
<meta name="author" content="{{ meta_tags.author }}">
<meta name="copyright" content="{{ meta_tags.copyright }}">
<meta name="robots" content="{{ meta_tags.robots }}">

<!-- Open Graph -->
<meta property="og:title" content="{{ meta_tags.og_title }}">
<meta property="og:description" content="{{ meta_tags.og_description }}">
{% if meta_tags.og_image %}
<meta property="og:image" content="{{ meta_tags.og_image }}">
{% endif %}
<meta property="og:type" content="{{ meta_tags.og_type }}">
<meta property="og:url" content="{{ meta_tags.og_url }}">

<!-- Twitter Card -->
<meta name="twitter:card" content="{{ meta_tags.twitter_card }}">
{% if meta_tags.twitter_site %}
<meta name="twitter:site" content="{{ meta_tags.twitter_site }}">
{% endif %}
{% if meta_tags.twitter_creator %}
<meta name="twitter:creator" content="{{ meta_tags.twitter_creator }}">
{% endif %}
<meta name="twitter:title" content="{{ meta_tags.twitter_title }}">
<meta name="twitter:description" content="{{ meta_tags.twitter_description }}">
{% if meta_tags.twitter_image %}
<meta name="twitter:image" content="{{ meta_tags.twitter_image }}">
{% endif %}

<!-- اسکیما JSON-LD -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ request.build_absolute_uri }}"
  },
  "headline": "{{ post.title|escapejs }}",
  "description": "{{ post.excerpt|default:post.seo_description|escapejs }}",
  {% if post.cover_image %}
  "image": {
    "@type": "ImageObject",
    "url": "{{ post.cover_image.url }}",
    "width": "1200",
    "height": "630"
  },
  {% endif %}
  "datePublished": "{{ post.publish_at|date:'c' }}",
  "dateModified": "{{ post.updated_at|date:'c' }}",
  "author": {
    "@type": "Person",
    "name": "{{ post.author.display_name|escapejs }}"
    {% if post.author.avatar %}
    ,"image": "{{ post.author.avatar.url }}"
    {% endif %}
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ SITE_NAME|default:'وبلاگ ما' }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ media_url }}image/logo.png",
      "width": "180",
      "height": "60"
    }
  },
  "articleSection": "{{ post.category.name|escapejs }}",
  "keywords": [
    {% for tag in post.tags.all %}"{{ tag.name|escapejs }}"{% if not forloop.last %},{% endif %}{% endfor %}
  ],
  "wordCount": "{{ post.content|length }}",
  "timeRequired": "PT{{ post.reading_time|default:5 }}M",
  "inLanguage": "fa-IR",
  "interactionStatistic": {
    "@type": "InteractionCounter",
    "interactionType": "https://schema.org/ViewAction",
    "userInteractionCount": "{{ post.views }}"
  }
}
</script>
{% endblock meta1 %}

{% block content %}

<main class="pt-24 md:pt-48 px-2 md:px-10">
    <div class="flex flex-col lg:flex-row gap-5 pb-20">
      <!-- Sidebar - مقالات مرتبط -->
      <div class="lg:w-3/12 h-fit order-2 md:order-1">
        <div class="flex gap-x-2 justify-between items-center mb-4">
          <div class="h-[1px] w-full bg-gradient-to-r from-white via-zinc-300 to-white">
          </div>
          <div class="w-48 min-w-fit text-zinc-700 md:font-yekanBakhBold md:text-lg">
            مقالات مرتبط
          </div>
          <div class="h-[1px] w-full bg-gradient-to-r from-white via-zinc-300 to-white">
          </div>
        </div>
        <div class="border border-zinc-300 rounded-3xl p-3 space-y-8">
          {% for related_post in related_posts %}
          <div class="min-h-60 transition group">
            <a href="{% url 'blog:detail' slug=related_post.slug %}" class="image-box block overflow-hidden rounded-lg md:rounded-2xl">
              {% if related_post.cover_image %}
              <img class="rounded-lg md:rounded-2xl max-h-56 w-full transition-transform duration-300 ease-in-out group-hover:rotate-3 group-hover:scale-110"
                   src="{{ related_post.cover_image.url }}"
                   alt="{{ related_post.title }}" />
              {% else %}
              <img class="rounded-lg md:rounded-2xl max-h-56 w-full transition-transform duration-300 ease-in-out group-hover:rotate-3 group-hover:scale-110"
                   src="{{ media_url }}image/blog/default.jpg"
                   alt="{{ related_post.title }}" />
              {% endif %}
            </a>
            <div class="p-2 mt-2">
              <a href="{% url 'blog:detail' slug=related_post.slug %}" class="text-xs md:text-sm font-normal md:font-semibold text-zinc-700 group-hover:text-primary-500 h-12 line-clamp-2 leading-6">
                {{ related_post.title }}
              </a>
              <div class="flex justify-between mt-8">
                <div class="text-xs flex gap-x-1 items-center text-zinc-400">
                  <svg class="fill-zinc-400" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="" viewBox="0 0 256 256">
                    <path d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM72,48v8a8,8,0,0,0,16,0V48h80v8a8,8,0,0,0,16,0V48h24V80H48V48ZM208,208H48V96H208V208Z"></path>
                  </svg>
                  {{ related_post.publish_at|date:"Y/m/d" }}
                </div>
                <a href="{{ related_post.get_absolute_url }}" class="flex justify-center items-center gap-x-1 group w-fit text-xs md:text-sm transition text-zinc-600 group-hover:text-primary-500">
                  ادامه مطلب
                  <svg class="fill-zinc-600 transition group-hover:fill-primary-500 size-2 md:size-4" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="" viewBox="0 0 256 256">
                    <path d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z"></path>
                  </svg>
                </a>
              </div>
            </div>
          </div>
          {% empty %}
          <div class="text-center py-8 text-zinc-500">
            مقاله مرتبطی یافت نشد.
          </div>
          {% endfor %}
        </div>

        <!-- اشتراک گذاری در شبکه های اجتماعی -->
        <div class="bg-white rounded-3xl border border-zinc-300 p-4 h-fit mt-5">
          <div class="text-center px-2 py-2 text-gray-600">
            اشتراک گذاری در شبکه های اجتماعی
          </div>
          <div class="flex gap-5 w-fit p-4 mx-auto">
            <!-- تلگرام -->
            <a class="block w-fit p-1 bg-white rounded-full" href="https://t.me/share/url?url={{ request.build_absolute_uri }}&text={{ post.title }}" target="_blank">
                <svg class="rounded-full" width="40" height="40" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- SVG تلگرام -->
                    <g id="Frame" clip-path="url(#clip0_4667_548)">
                        <g id="Isolation Mode">
                            <path id="Vector" fill-rule="evenodd" clip-rule="evenodd" d="M8.72696 8.16637e-05H21.2724C25.8728 8.16637e-05 29.6361 3.75792 29.6361 8.35796V12.3916C25.512 14.2453 21.3518 23.4008 15.2883 21.4114C14.7889 21.7663 13.6378 23.2288 13.557 24.3385C11.4574 24.0589 9.03679 21.6527 9.32727 19.058C5.83255 16.5301 8.71846 11.8638 11.4897 9.9856C17.4293 5.96007 25.6751 9.42212 21.0884 12.3004C18.2994 14.0505 12.3354 15.2066 12.9554 10.9101C11.3194 11.382 10.2721 14.4326 12.2419 16.0223C10.4172 17.815 10.768 21.1105 12.7185 22.1925C14.6912 17.0814 21.5571 17.7494 24.3311 11.6481C26.4182 7.05861 23.3239 1.82911 17.1373 2.63243C12.4682 3.23879 8.09169 7.17735 5.90294 11.8486C3.68218 16.588 4.01267 22.9345 8.57278 26.1331C13.9393 29.8971 19.6528 26.4118 23.1132 21.8565C25.1529 19.1715 26.935 16.1972 29.6361 14.4792V21.6307C29.6361 26.2306 25.8723 30.0001 21.2724 30.0001H8.72696C4.12692 30.0001 0.363281 26.2364 0.363281 21.6364V8.36368C0.363281 3.76364 4.12692 0 8.72696 0V8.16637e-05Z" fill="#EE7F22"></path>
                        </g>
                    </g>
                    <defs>
                        <clipPath id="clip0_4667_548">
                            <rect width="30" height="30" fill="white"></rect>
                        </clipPath>
                    </defs>
                </svg>
            </a>

            <!-- واتساپ -->
            <a class="block w-fit p-1 bg-white rounded-full" href="https://wa.me/?text={{ post.title }} - {{ request.build_absolute_uri }}" target="_blank">
                <svg class="rounded-full" width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- SVG واتساپ -->
                </svg>
            </a>

            <!-- لینکدین -->
            <a class="block w-fit p-1 bg-white rounded-full" href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri }}" target="_blank">
                <svg class="rounded-full" width="40" height="40" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- SVG لینکدین -->
                </svg>
            </a>
          </div>
        </div>

        <!-- لینک کوتاه -->
        <div class="bg-white rounded-3xl border border-zinc-300 p-4 h-fit mt-5">
          <div class="text-center px-2 py-2 text-gray-600">
            لینک کوتاه مقاله
          </div>
          <div class="flex justify-between items-center border border-dashed mx-auto px-4 py-3 rounded-xl border-primary-500 bg-primary-500/20">
            <img onclick="copyToClipboard()" id="copyIcon" class="size-9 cursor-pointer" src="{{ media_url }}image/icons/icons8-copy-64.png" alt="کپی">
            <div class="text-lg text-primary-500 font-yekanBakhBold" id="shortLink">
              {{ request.build_absolute_uri|truncatechars:20 }}
            </div>
          </div>
        </div>

        <!-- برچسب ها -->
        <div class="bg-white rounded-xl border border-zinc-300 p-4 h-fit mt-5">
          <div class="text-center px-2 py-2 text-gray-600">
            برچسب ها
          </div>
          <div class="flex gap-2 flex-wrap">
            {% for tag in post.tags.all %}
            <a href="" class="bg-zinc-200 text-zinc-500 hover:text-zinc-600 transition px-2 py-1 text-sm rounded-lg w-fit">
              #{{ tag.name }}
            </a>
            {% empty %}
            <span class="text-zinc-500 text-sm">برچسبی وجود ندارد</span>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- محتوای اصلی مقاله -->
      <div class="lg:w-9/12 order-1 md:order-2">
        <!-- breadcrumb -->
        <div class="mb-7 text-xs flex flex-wrap space-y-2 md:space-y-0 items-center gap-x-2 opacity-90">
          <a href="" class="text-zinc-500 hover:text-primary-500 transition">
            مقالات
          </a>
          <svg class="size-3 fill-zinc-500" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#3d3d3d" viewBox="0 0 256 256">
            <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
          </svg>
          {% if post.category %}
          <a href="" class="text-zinc-500 hover:text-primary-500 transition">
            {{ post.category.name }}
          </a>
          <svg class="size-3 fill-zinc-500" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#3d3d3d" viewBox="0 0 256 256">
            <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
          </svg>
          {% endif %}
          <a class="text-primary-500 line-clamp-1" href="">
            {{ post.title }}
          </a>
        </div>

        <!-- محتوای مقاله -->
        <div class="border border-zinc-300 rounded-3xl p-1.5 md:p-3">
          <!-- تصویر اصلی -->
          {% if post.cover_image %}
          <img class="w-full h-72 md:h-96 rounded-3xl object-cover object-center mb-3.5"
               src="{{ post.cover_image.url }}"
               alt="{{ post.title }}">
          {% endif %}

          <!-- متا اطلاعات -->
          <div class="flex gap-4 mb-10 flex-wrap">
            <!-- تاریخ انتشار -->
            <div class="text-xs flex gap-x-1 items-center text-zinc-400">
              <svg class="fill-zinc-400" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="" viewBox="0 0 256 256">
                <path d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM72,48v8a8,8,0,0,0,16,0V48h80v8a8,8,0,0,0,16,0V48h24V80H48V48ZM208,208H48V96H208V208Z"></path>
              </svg>
              {{ post.publish_at|date:"Y/m/d" }}
            </div>

            <!-- نویسنده -->
            <div class="text-xs flex gap-x-1 items-center text-zinc-400">
              <svg class="fill-zinc-400" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#000000" viewBox="0 0 256 256">
                <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24ZM74.08,197.5a64,64,0,0,1,107.84,0,87.83,87.83,0,0,1-107.84,0ZM96,120a32,32,0,1,1,32,32A32,32,0,0,1,96,120Zm97.76,66.41a79.66,79.66,0,0,0-36.06-28.75,48,48,0,1,0-59.4,0,79.66,79.66,0,0,0-36.06,28.75,88,88,0,1,1,131.52,0Z"></path>
              </svg>
              نوشته شده توسط {{ post.author.display_name }}
            </div>

            <!-- دسته بندی -->
            {% if post.category %}
            <div class="text-xs flex gap-x-1 items-center text-zinc-400">
              <svg class="fill-zinc-400" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#000000" viewBox="0 0 256 256">
                <path d="M224,64H154.67L126.93,43.2a16.12,16.12,0,0,0-9.6-3.2H72A16,16,0,0,0,56,56V72H40A16,16,0,0,0,24,88V200a16,16,0,0,0,16,16H192.89A15.13,15.13,0,0,0,208,200.89V184h16.89A15.13,15.13,0,0,0,240,168.89V80A16,16,0,0,0,224,64ZM192,200H40V88H85.33l27.74,20.8a16.12,16.12,0,0,0,9.6,3.2H192Zm32-32H208V112a16,16,0,0,0-16-16H122.67L94.93,75.2a16.12,16.12,0,0,0-9.6-3.2H72V56h45.33l27.74,20.8a16.12,16.12,0,0,0,9.6,3.2H224Z"></path>
              </svg>
              دسته بندی
              <a class="hover:text-primary-400 transition" href="">
                {{ post.category.name }}
              </a>
            </div>
            {% endif %}

            <!-- تعداد بازدید -->
            <div class="text-xs flex gap-x-1 items-center text-zinc-400">
              <svg class="fill-zinc-400" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#000000" viewBox="0 0 256 256">
                <path d="M247.31,124.76c-.35-.79-8.82-19.58-27.65-38.41C194.57,61.26,162.88,48,128,48S61.43,61.26,36.34,86.35C17.51,105.18,9,124,8.69,124.76a8,8,0,0,0,0,6.5c.35.79,8.82,19.57,27.65,38.4C61.43,194.74,93.12,208,128,208s66.57-13.26,91.66-38.34c18.83-18.83,27.3-37.61,27.65-38.4A8,8,0,0,0,247.31,124.76ZM128,192c-30.78,0-57.67-11.19-79.93-33.25A133.47,133.47,0,0,1,25,128,133.33,133.33,0,0,1,48.07,97.25C70.33,75.19,97.22,64,128,64s57.67,11.19,79.93,33.25A133.46,133.46,0,0,1,231.05,128C223.84,141.46,192.43,192,128,192Zm0-112a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Z"></path>
              </svg>
              {{ post.views }} بازدید
            </div>

            <!-- زمان مطالعه -->
            {% if post.reading_time %}
            <div class="flex items-start gap-x-1 text-xs text-zinc-400">
              <svg class="fill-gray-400" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="" viewBox="0 0 256 256">
                <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm64-88a8,8,0,0,1-8,8H128a8,8,0,0,1-8-8V72a8,8,0,0,1,16,0v48h48A8,8,0,0,1,192,128Z"></path>
              </svg>
              <span>{{ post.reading_time }} دقیقه</span>
            </div>
            {% endif %}
          </div>

          <!-- عنوان مقاله -->
          <h1 class="text-xl md:text-3xl text-zinc-800 font-yekanBakhBold my-6 text-center">
            {{ post.title }}
          </h1>

          <!-- محتوای مقاله -->
          <div style='text-align: justify;' class="prose max-w-none">
           {% autoescape off %}
            {{ post.description }}
           {% endautoescape %}
          </div>
        </div>
      </div>
    </div>
</main>

<script>
function copyToClipboard() {
    const shortLink = document.getElementById('shortLink');
    const textArea = document.createElement('textarea');
    textArea.value = '{{ request.build_absolute_uri }}';
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);

    // نمایش پیام موفقیت
    const copyIcon = document.getElementById('copyIcon');
    const originalSrc = copyIcon.src;
    copyIcon.src = '{{ media_url }}image/icons/icons8-checkmark-64.png';

    setTimeout(() => {
        copyIcon.src = originalSrc;
    }, 2000);
}
</script>

{% endblock content %}