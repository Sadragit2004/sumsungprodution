{% extends "db_template.html" %}
{% load static %}

{% block content %}
<!-- bg blur mobile -->
<div id="overlay" class="fixed z-10 inset-0 bg-black/35 hidden transition-opacity duration-300"></div>

    <main class="p-6 flex-1 overflow-y-auto">
        <div class="bg-white rounded-2xl min-h-80 h-auto shadow-custom p-4">
            <!-- بخش آمار -->
            <div class="px-2 md:px-3 pt-3 pb-5 mb-3 text-zinc-700 text-sm md:text-base flex items-center gap-x-2 border-b border-zinc-200">
                <svg class="fill-primary-500" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="" viewBox="0 0 256 256">
                    <path d="M128,16a88.1,88.1,0,0,0-88,88c0,75.3,80,132.17,83.41,134.55a8,8,0,0,0,9.18,0C136,236.17,216,179.3,216,104A88.1,88.1,0,0,0,128,16Zm0,56a32,32,0,1,1-32,32A32,32,0,0,1,128,72Z"></path>
                </svg>
                صفحه اصلی
            </div>

            <!-- کارت‌های آمار -->
            <div class="grid grid-cols-2 md:flex gap-5 text-xs md:text-sm">
                <!-- سفارشات کل -->
                <div class="flex md:w-1/4 gap-x-2 items-center bg-gradient-to-bl from-blue-500 to-blue-700 rounded-2xl p-3">
                    <svg class="fill-zinc-100 bg-blue-600 rounded-xl p-1" xmlns="http://www.w3.org/2000/svg" width="44" height="44" fill="#000000" viewBox="0 0 256 256">
                        <path d="M216,64l-12.16,66.86A16,16,0,0,1,188.1,144H62.55L48,64Z" opacity="0.2"></path>
                        <path d="M222.14,58.87A8,8,0,0,0,216,56H54.68L49.79,29.14A16,16,0,0,0,34.05,16H16a8,8,0,0,0,0,16h18L59.56,172.29a24,24,0,0,0,5.33,11.27,28,28,0,1,0,44.4,8.44h45.42A27.75,27.75,0,0,0,152,204a28,28,0,1,0,28-28H83.17a8,8,0,0,1-7.87-6.57L72.13,152h116a24,24,0,0,0,23.61-19.71l12.16-66.86A8,8,0,0,0,222.14,58.87ZM96,204a12,12,0,1,1-12-12A12,12,0,0,1,96,204Zm96,0a12,12,0,1,1-12-12A12,12,0,0,1,192,204Zm4-74.57A8,8,0,0,1,188.1,136H69.22L57.59,72H206.41Z"></path>
                    </svg>
                    <div class="text-zinc-100 space-y-1">
                        <div>سفارشات کل</div>
                        <div class="text-lg font-bold">{{ total_orders }}</div>
                    </div>
                </div>

                <!-- تحویل داده شده -->
                <div class="flex md:w-1/4 gap-x-2 items-center bg-gradient-to-bl from-green-500 to-green-700 rounded-2xl p-3">
                    <svg class="fill-zinc-100 bg-green-600 rounded-xl p-1" xmlns="http://www.w3.org/2000/svg" width="44" height="44" fill="#000000" viewBox="0 0 256 256">
                        <path d="M16,152H48v56H16a8,8,0,0,1-8-8V160A8,8,0,0,1,16,152ZM204,56a28,28,0,0,0-12,2.71h0A28,28,0,1,0,176,85.29h0A28,28,0,1,0,204,56Z" opacity="0.2"></path>
                        <path d="M230.33,141.06a24.43,24.43,0,0,0-21.24-4.23l-41.84,9.62A28,28,0,0,0,140,112H89.94a31.82,31.82,0,0,0-22.63,9.37L44.69,144H16A16,16,0,0,0,0,160v40a16,16,0,0,0,16,16H120a7.93,7.93,0,0,0,1.94-.24l64-16a6.94,6.94,0,0,0,1.19-.4L226,182.82l.44-.2a24.6,24.6,0,0,0,3.93-41.56ZM16,160H40v40H16Zm203.43,8.21-38,16.18L119,200H56V155.31l22.63-22.62A15.86,15.86,0,0,1,89.94,128H140a12,12,0,0,1,0,24H112a8,8,0,0,0,0,16h32a8.32,8.32,0,0,0,1.79-.2l67-15.41.31-.08a8.6,8.6,0,0,1,6.3,15.9ZM164,96a36,36,0,0,0,5.9-.48,36,36,0,1,0,28.22-47A36,36,0,1,0,164,96Zm60-12a20,20,0,1,1-20-20A20,20,0,0,1,224,84ZM164,40a20,20,0,0,1,19.25,14.61,36,36,0,0,0-15,24.93A20.42,20.42,0,0,1,164,80a20,20,0,0,1,0-40Z"></path>
                    </svg>
                    <div class="text-zinc-100 space-y-1">
                        <div>تحویل داده شده</div>
                        <div class="text-lg font-bold">{{ delivered_orders }}</div>
                    </div>
                </div>

                <!-- لغو شده -->
                <div class="flex md:w-1/4 gap-x-2 items-center bg-gradient-to-bl from-red-500 to-red-700 rounded-2xl p-3">
                    <svg class="fill-zinc-100 bg-red-600 rounded-xl p-1" xmlns="http://www.w3.org/2000/svg" width="44" height="44" fill="#000000" viewBox="0 0 256 256">
                        <path d="M216,64l-12.16,66.86A16,16,0,0,1,188.1,144H62.55L48,64Z" opacity="0.2"></path>
                        <path d="M222.14,58.87A8,8,0,0,0,216,56H54.68L49.79,29.14A16,16,0,0,0,34.05,16H16a8,8,0,0,0,0,16h18L59.56,172.29a24,24,0,0,0,5.33,11.27,28,28,0,1,0,44.4,8.44h45.42A27.75,27.75,0,0,0,152,204a28,28,0,1,0,28-28H83.17a8,8,0,0,1-7.87-6.57L72.13,152h116a24,24,0,0,0,23.61-19.71l12.16-66.86A8,8,0,0,0,222.14,58.87ZM96,204a12,12,0,1,1-12-12A12,12,0,0,1,96,204Zm96,0a12,12,0,1,1-12-12A12,12,0,0,1,192,204Zm4-74.57A8,8,0,0,1,188.1,136H69.22L57.59,72H206.41Z"></path>
                    </svg>
                    <div class="text-zinc-100 space-y-1">
                        <div>لغو شده</div>
                        <div class="text-lg font-bold">{{ canceled_orders }}</div>
                    </div>
                </div>

                <!-- مرجوع شده -->
                <div class="flex md:w-1/4 gap-x-2 items-center bg-gradient-to-bl from-yellow-500 to-yellow-700 rounded-2xl p-3">
                    <svg class="fill-zinc-100 bg-yellow-600 rounded-xl p-1" xmlns="http://www.w3.org/2000/svg" width="44" height="44" fill="#000000" viewBox="0 0 256 256">
                        <path d="M240,104,128,224,80,104l48-64h56Z" opacity="0.2"></path>
                        <path d="M246,98.73l-56-64A8,8,0,0,0,184,32H72a8,8,0,0,0-6,2.73l-56,64a8,8,0,0,0,.17,10.73l112,120a8,8,0,0,0,11.7,0l112-120A8,8,0,0,0,246,98.73ZM222.37,96H180L144,48h36.37ZM74.58,112l30.13,75.33L34.41,112Zm89.6,0L128,202.46,91.82,112ZM96,96l32-42.67L160,96Zm85.42,16h40.17l-70.3,75.33ZM75.63,48H112L76,96H33.63Z"></path>
                    </svg>
                    <div class="text-zinc-100 space-y-1">
                        <div>مرجوع شده</div>
                        <div class="text-lg font-bold">{{ returned_orders }}</div>
                    </div>
                </div>
            </div>

            <!-- آخرین سفارشات -->
            <div class="px-2 md:px-3 pt-16 pb-5 mb-3 text-zinc-700 text-sm md:text-base flex items-center gap-x-2 border-b border-zinc-200">
                <svg class="fill-primary-500" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="" viewBox="0 0 256 256">
                    <path d="M128,16a88.1,88.1,0,0,0-88,88c0,75.3,80,132.17,83.41,134.55a8,8,0,0,0,9.18,0C136,236.17,216,179.3,216,104A88.1,88.1,0,0,0,128,16Zm0,56a32,32,0,1,1-32,32A32,32,0,0,1,128,72Z"></path>
                </svg>
                آخرین سفارشات
            </div>

            <!-- جدول سفارشات -->
            <div class="relative flex flex-col w-full h-full overflow-scroll text-gray-700">
                <table class="w-full text-right table-auto min-w-max">
                    <thead>
                        <tr>
                            <th class="p-4 border-b border-b-zinc-400">
                                <p class="block text-sm opacity-70">شماره سفارش</p>
                            </th>
                            <th class="p-4 border-b border-b-zinc-400">
                                <p class="block text-sm opacity-70">تاریخ</p>
                            </th>
                            <th class="p-4 border-b border-b-zinc-400">
                                <p class="block text-sm opacity-70">مبلغ</p>
                            </th>
                            <th class="p-4 border-b border-b-zinc-400">
                                <p class="block text-sm opacity-70">وضعیت</p>
                            </th>
                            <th class="p-4 border-b border-b-zinc-400">
                                <p class="block text-sm opacity-70">جزئیات</p>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in latest_orders %}
                        <tr class="even:bg-zinc-100 hover:bg-zinc-50 transition-colors">
                            <td class="p-4">
                                <p class="block text-sm font-medium">#{{ order.orderCode|slice:":8" }}</p>
                            </td>
                            <td class="p-4">
                                <p class="block text-sm">{{ order.jalali_date }}</p>
                            </td>
                            <td class="p-4">
                                <p class="block text-sm font-medium">{{ order.final_price|floatformat:0 }} تومان</p>
                            </td>
                            <td class="p-4">
                                <p class="block text-sm">
                                    {% if order.status == "pending" %}
                                        <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs">در حال بررسی</span>
                                    {% elif order.status == "processing" %}
                                        <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">در حال پردازش</span>
                                    {% elif order.status == "shipped" %}
                                        <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs">ارسال شده</span>
                                    {% elif order.status == "delivered" %}
                                        <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">تحویل داده شده</span>
                                    {% elif order.status == "canceled" %}
                                        <span class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">لغو شده</span>
                                    {% endif %}
                                </p>
                            </td>
                            <td class="p-4">
                                <a href="#" class="block text-xs text-blue-600 hover:text-blue-800 font-medium transition-colors">مشاهده</a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="p-8 text-center">
                                <div class="flex flex-col items-center justify-center text-gray-500">
                                    <svg class="w-12 h-12 mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                                    </svg>
                                    <p class="text-sm">هیچ سفارشی یافت نشد</p>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- محصولات پیشنهادی -->
            <div class="mt-12 md:mt-20">
                <!-- هدر اسلایدر -->
                <div class="flex gap-x-4 justify-between items-center mb-7">
                    <div class="w-48 min-w-fit text-zinc-700 md:font-yekanBakhBold text-lg">
                        <i class="fas fa-gift text-primary-500 ml-2"></i>
                        محصولات پیشنهادی برای شما
                    </div>
                    <div class="flex gap-2">
                        <button class="swiper-button-prev-product bg-zinc-100 hover:bg-zinc-200 p-2 rounded-lg transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                        <button class="swiper-button-next-product bg-zinc-100 hover:bg-zinc-200 p-2 rounded-lg transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- اسلایدر محصولات -->
                <div class="containerPSlider swiper product-slider">
                    <div class="swiper-wrapper pb-10">
                        {% for product_data in recommended_products %}
                        <div class="swiper-slide">
                            <div class="bg-white border border-zinc-200 rounded-2xl p-3 text-sm hover:shadow-custom transition-all duration-300 hover:border-primary-200 h-full flex flex-col group">
                                <!-- تصویر محصول -->
                                <a href="{{ product_data.product.get_absolute_url }}" class="block flex-1 relative">
                                    {% if product_data.image_url %}
                                        <img class="rounded-xl mb-3 w-full h-40 object-cover group-hover:scale-105 transition-transform duration-300"
                                             src="{{ product_data.image_url }}"
                                             alt="{{ product_data.short_title }}"
                                             loading="lazy">
                                    {% else %}
                                        <div class="rounded-xl mb-3 w-full h-40 bg-zinc-100 flex items-center justify-center group-hover:scale-105 transition-transform duration-300">
                                            <svg class="w-12 h-12 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                            </svg>
                                        </div>
                                    {% endif %}

                                    <!-- نشانگر تخفیف -->
                                    {% if product_data.discount_percentage > 0 %}
                                    <div class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold">
                                        {{ product_data.discount_percentage }}%
                                    </div>
                                    {% endif %}
                                </a>

                                <!-- برند محصول -->
                                <p class="text-zinc-500 text-xs mb-1">{{ product_data.brand }}</p>

                                <!-- عنوان محصول -->
                                <a href="{{ product_data.product.get_absolute_url }}" class="text-zinc-800 text-sm font-medium h-12 line-clamp-2 mb-3 hover:text-primary-600 transition-colors">
                                    {{ product_data.short_title }}
                                </a>

                                <!-- رنگ‌ها و امتیاز -->
                                <div class="flex items-center justify-between mt-auto">
                                    <div class="flex gap-1.5">
                                        {% for color in product_data.colors %}
                                        <div class="size-3 rounded-full border border-zinc-300 tooltip"
                                             style="background-color: {{ color }};"
                                             title="{{ color }}">
                                        </div>
                                        {% endfor %}
                                    </div>
                                    <div class="flex items-center gap-x-1 text-xs text-zinc-500">
                                        <span>({{ product_data.comments_count }})</span>
                                        <span>{{ product_data.rating }}</span>
                                        <div class="flex">
                                            {% for i in "12345" %}
                                                {% if forloop.counter <= product_data.rating %}
                                                    <svg class="w-3 h-3 fill-yellow-400" viewBox="0 0 20 20">
                                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                                    </svg>
                                                {% else %}
                                                    <svg class="w-3 h-3 fill-zinc-300" viewBox="0 0 20 20">
                                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                                    </svg>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>

                                <!-- قیمت و دکمه خرید -->
                                <div class="flex items-center justify-between border-t border-dashed border-zinc-300 mt-3 pt-3">
                                    {% if product_data.discount_percentage > 0 %}
                                        <div class="flex items-center gap-2">
                                            <div class="text-zinc-400 line-through text-xs">
                                                {{ product_data.price|floatformat:0 }}
                                            </div>
                                        </div>
                                    {% else %}
                                        <div></div>
                                    {% endif %}
                                    <div class="text-zinc-800 flex items-center gap-x-1 font-yekanBakhBold text-lg">
                                        {{ product_data.final_price|floatformat:0 }}
                                        <img class="size-4" src="{{ media_url }}image/icons/toman.png" alt="تومان">
                                    </div>
                                </div>

                                <button class="w-full mt-3 bg-primary-500 hover:bg-primary-600 text-white py-2 rounded-xl text-sm font-medium transition-colors duration-200 group-hover:shadow-lg">
                                    <i class="fas fa-shopping-cart ml-2"></i>
                                    افزودن به سبد خرید
                                </button>
                            </div>
                        </div>
                        {% empty %}
                        <div class="swiper-slide">
                            <div class="bg-white border border-zinc-200 rounded-2xl p-8 text-center">
                                <svg class="w-16 h-16 mx-auto text-zinc-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                                </svg>
                                <p class="text-zinc-500 text-sm">هیچ محصول پیشنهادی یافت نشد</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Pagination -->
                    <div class="swiper-pagination mt-6"></div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-white h-12 flex items-center justify-end px-5 w-full text-zinc-500 text-xs shrink-0 border-t border-zinc-200">
        تمامی حقوق توسط تیم برنامه نویسی امیران محفوظ است.
    </footer>
</div>


<script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize product slider
    const productSwiper = new Swiper('.product-slider', {
        slidesPerView: 1,
        spaceBetween: 16,
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
            dynamicBullets: true,
        },
        navigation: {
            nextEl: '.swiper-button-next-product',
            prevEl: '.swiper-button-prev-product',
        },
        breakpoints: {
            480: {
                slidesPerView: 2,
                spaceBetween: 16,
            },
            768: {
                slidesPerView: 3,
                spaceBetween: 20,
            },
            1024: {
                slidesPerView: 4,
                spaceBetween: 24,
            },
            1280: {
                slidesPerView: 5,
                spaceBetween: 24,
            },
        },
    });

    // Add hover effects
    const productCards = document.querySelectorAll('.swiper-slide > div');
    productCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });

    // Tooltip for colors
    const colorDots = document.querySelectorAll('.tooltip');
    colorDots.forEach(dot => {
        dot.addEventListener('mouseenter', function(e) {
            const tooltip = document.createElement('div');
            tooltip.className = 'absolute bg-black text-white text-xs px-2 py-1 rounded -top-8 right-1/2 transform translate-x-1/2 z-50';
            tooltip.textContent = this.getAttribute('title');
            this.appendChild(tooltip);
        });

        dot.addEventListener('mouseleave', function() {
            const tooltip = this.querySelector('div');
            if (tooltip) {
                tooltip.remove();
            }
        });
    });
});
</script>

<link rel="stylesheet" href="https://unpkg.com/swiper@8/swiper-bundle.min.css" />
<style>
.swiper-pagination-bullet {
    background: #d1d5db;
    opacity: 1;
    width: 8px;
    height: 8px;
}
.swiper-pagination-bullet-active {
    background: #3b82f6;
    width: 24px;
    border-radius: 4px;
}
.product-slider {
    padding: 10px 5px 40px 5px;
    margin: -10px -5px -40px -5px;
}
.swiper-slide {
    height: auto;
}
.group:hover .group-hover\:scale-105 {
    transform: scale(1.05);
}
.tooltip {
    position: relative;
    cursor: pointer;
}
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>
{% endblock content %}

